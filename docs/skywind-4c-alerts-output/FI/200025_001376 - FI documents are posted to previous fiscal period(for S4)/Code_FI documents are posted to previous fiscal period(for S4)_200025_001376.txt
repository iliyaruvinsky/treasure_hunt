FUNCTION /SKN/FC_SW_10_07_FI_DOC_POS_S4.
*"----------------------------------------------------------------------
*"*"Local Interface:
*"  EXPORTING
*"     VALUE(IS_ALERT) TYPE  CHAR1
*"  TABLES
*"      T_SELECT STRUCTURE  RSSELECT
*"      T_DATA STRUCTURE  /SKN/S_SW_10_07_FI_DOC_POST_S4
*"----------------------------------------------------------------------
  DATA_MULTY: DATUM DATUM.
  DATA_MULTY: CPUDT CPUDT.
  DATA_MULTY: BUKRS BUKRS.
  DATA_MULTY: BELNR BELNR_D.
  DATA_MULTY: GJAHR GJAHR.
  DATA_MULTY: BLDAT BLDAT.
  DATA_MULTY: BUDAT BUDAT.
  DATA_MULTY: MONAT MONAT.
  DATA_MULTY: AEDAT AEDAT_BKPF.
  DATA_MULTY: UPDDT UPDDT.
  DATA_MULTY: SEGMENT	FB_SEGMENT.
  DATA_MULTY: USNAM USNAM.
  DATA_MULTY: TCODE TCODE.
  DATA_MULTY: XBLNR XBLNR1.
  DATA_MULTY: STBLG STBLG.
  DATA_MULTY: BKTXT BKTXT.
  DATA_MULTY: KURSF KURSF.
  DATA_MULTY: BSTAT BSTAT_D.
  DATA_MULTY: GRPID GRPID_BKPF.
  DATA_MULTY: XREVERSAL XREVERSAL.
  DATA_MULTY: KURS2 KURS2.
  DATA_MULTY: KURS3 KURS3.
* ACDOCA
  DATA_MULTY: RBUKRS BUKRS.
  DATA_MULTY: RLDNR  /SKN/E_MN_AN_RLDNR.
  DATA_MULTY: DOCLN  DOCLN6.
  DATA_MULTY: RCNTR  KOSTL.
  DATA_MULTY: PRCTR  PRCTR.
  DATA_MULTY: RFAREA FKBER.
  DATA_MULTY: RBUSA  GSBER.
  DATA_MULTY: SPART  SPART.
  DATA_MULTY: SGTXT  SGTXT.
  DATA_MULTY: KTOPL  KTOPL.
  DATA_MULTY: KOKRS	 KOKRS.
  DATA_MULTY: KTOSL	 KTOSL.
  DATA_MULTY: EBELN  EBELN.
  DATA_MULTY: EBELP  EBELP.
  DATA_MULTY: MATNR  MATNR.
  DATA_MULTY: WERKS  WERKS_D.
  DATA_MULTY: LIFNR  LIFNR.
  DATA_MULTY: KUNNR  KUNNR.
  DATA_MULTY: FKART  FKART.
  DATA_MULTY: VKORG  VKORG.
  DATA_MULTY: VTWEG  VTWEG.
  DATA_MULTY: RACCT  RACCT.
  DATA_MULTY: MATKL  MATKL.
  DATA_MULTY: KDGRP  KDGRP.
  DATA_MULTY: LAND1  LAND1_GP.
  DATA_MULTY: BLART  BLART.
  DATA_MULTY: HSL	   /SKN/E_MN_AN_HSL.
  DATA_MULTY: HVKWRT /SKN/E_MN_AN_HVKWRT.
  DATA_MULTY: KSL	   /SKN/E_MN_AN_KSL.
  DATA_MULTY: OSL  	 /SKN/E_MN_AN_OSL.
  DATA_MULTY: PSL	   /SKN/E_MN_AN_PSL.
  DATA_MULTY: TSL    /SKN/E_MN_AN_TSL.
  DATA_MULTY: VSL    /SKN/E_MN_AN_VSL.
  DATA_MULTY: WSL    /SKN/E_MN_AN_WSL.
  DATA_MULTY: WSL2   /SKN/E_MN_AN_WSL2.
  DATA_MULTY: WSL3   /SKN/E_MN_AN_WSL3.
  DATA_MULTY: RHCUR  /SKN/E_MN_AN_RHCUR.
  DATA_MULTY: RKCUR  /SKN/E_MN_AN_RKCUR.
  DATA_MULTY: ROCUR  /SKN/E_MN_AN_ROCUR.
  DATA_MULTY: RTCUR  /SKN/E_MN_AN_RTCUR.
  DATA_MULTY: RVCUR  /SKN/E_MN_AN_RVCUR.
  DATA_MULTY: RWCUR  /SKN/E_MN_AN_RWCUR.
  DATA_MULTY: KOART KOART.
  DATA_SINGLE: PERIOD_CLOSING_DAY NUMC2.
  LV_PERIOD_CLOSING_DAY = 15.  " Default value
  DATA_SINGLE: BACKDAYS /SKN/E_MN_AN_BACKDAYS.
  LV_BACKDAYS = '10'.          " Default value
  DATA_SINGLE: DATE_REF_FLD NAME_FELD.
  LV_DATE_REF_FLD = 'CPUDT'.   " Default value
  DATA_MULTY: DURATION /SKN/E_SW_DURATION.
  DATA_SINGLE: DURATION_UNIT /SKN/E_SW_DURATION_UNIT.
  LV_DURATION_UNIT = 'D'.
  DATA_SINGLE: FORWDAYS /SKN/E_MN_AN_FORWDAYS.
  DATA_SINGLE: LANGU LANGU.
  LV_LANGU = 'EN'.
  DATA_SINGLE: TIME_REF_FLD NAME_FELD.
  DATA: FLD(60)   TYPE C,
        REF_DATE  TYPE D,
        TIME_DIFF TYPE INT4.
  DATA SY_DATLO LIKE SY-DATLO.
  DATA SY_TIMLO LIKE SY-TIMLO.
  DATA DATE_FROM LIKE SY-DATUM.
  DATA DATE_TO LIKE SY-DATUM.
  DATA: LT_DATA     LIKE T_DATA[],
        LT_DATA_TMP LIKE T_DATA[].
  SELECT_MULTY: CPUDT.
  SELECT_MULTY: BUKRS.
  SELECT_MULTY:  BELNR.
  CONVERT_MULTY: BELNR ALPHA.
  SELECT_MULTY:  GJAHR.
  CONVERT_MULTY: GJAHR GJAHR.
  SELECT_MULTY: BLDAT.
  SELECT_MULTY: BUDAT.
  SELECT_MULTY: MONAT.
  SELECT_MULTY: AEDAT.
  SELECT_MULTY: UPDDT.
  SELECT_MULTY: USNAM.
  SELECT_MULTY: TCODE.
  SELECT_MULTY: XBLNR.
  SELECT_MULTY:  STBLG.
  CONVERT_MULTY: STBLG ALPHA.
  SELECT_MULTY: BKTXT.
  SELECT_MULTY: KURSF.
  SELECT_MULTY: BSTAT.
  SELECT_MULTY: GRPID.
  SELECT_MULTY: KURS2.
  SELECT_MULTY: KURS3.
  SELECT_MULTY: XREVERSAL.
* ACDOCA
  SELECT_MULTY: RBUKRS.
  SELECT_MULTY: RLDNR.
  SELECT_MULTY: DOCLN.
  SELECT_MULTY: RCNTR.
  SELECT_MULTY: PRCTR.
  SELECT_MULTY: RFAREA.
  SELECT_MULTY: RBUSA.
  SELECT_MULTY: SPART.
  SELECT_MULTY: SGTXT.
  SELECT_MULTY: KTOPL.
  SELECT_MULTY: KOKRS.
  SELECT_MULTY: KTOSL.
  SELECT_MULTY: EBELN.
  SELECT_MULTY: EBELP.
  SELECT_MULTY: MATNR.
  SELECT_MULTY: WERKS.
  SELECT_MULTY: LIFNR.
  SELECT_MULTY: KUNNR.
  SELECT_MULTY: FKART.
  SELECT_MULTY: VKORG.
  SELECT_MULTY: VTWEG.
  SELECT_MULTY: RACCT.
  SELECT_MULTY: MATKL.
  SELECT_MULTY: KDGRP.
  SELECT_MULTY: LAND1.
  SELECT_MULTY: BLART.
  SELECT_MULTY: HSL.
  SELECT_MULTY: HVKWRT.
  SELECT_MULTY: KSL.
  SELECT_MULTY: OSL.
  SELECT_MULTY: PSL.
  SELECT_MULTY: TSL.
  SELECT_MULTY: VSL.
  SELECT_MULTY: WSL.
  SELECT_MULTY: WSL2.
  SELECT_MULTY: WSL3.
  SELECT_MULTY: RHCUR.
  SELECT_MULTY: RKCUR.
  SELECT_MULTY: ROCUR.
  SELECT_MULTY: RTCUR.
  SELECT_MULTY: RVCUR.
  SELECT_MULTY: RWCUR.
  SELECT_MULTY: KOART.
  SELECT_SINGLE: PERIOD_CLOSING_DAY.
  SELECT_SINGLE: BACKDAYS.
  SELECT_SINGLE: FORWDAYS.
  SELECT_SINGLE: DATE_REF_FLD.
  SELECT_SINGLE: TIME_REF_FLD.
  SELECT_SINGLE: DURATION_UNIT.
  SELECT_MULTY:  DURATION.
  SELECT_SINGLE:  LANGU.
  CONVERT_SINGLE: LANGU ISOLA.
  IF R_KOART IS INITIAL.
    RS_KOART-LOW = 'S'.
    APPEND RS_KOART TO R_KOART.
  ENDIF.
  DATA: LV_SW_DEST  TYPE RFCDEST,
        LV_TABIX    TYPE I,
        LV_TAB      TYPE DDOBJNAME,
        LV_TAB_CAT  TYPE TABCLASS,
        LV_BSEG     TYPE BOOLE_D,
        LV_ERROR    TYPE BOOLE_D,
        LV_ERR_MSG  TYPE BAPI_MSG,
        LV_KOART    TYPE KOART,
        LV_ROWCOUNT TYPE SOID-ACCNT.
  DATA: LS_OPTION            TYPE RFC_DB_OPT,
        LWA_TABLES_LIST      TYPE /SKN/S_TABLES,
        LWA_IN_RANGE         TYPE /SKN/S_SW_RANGE_TAB,
        LWA_JOIN_CONDITION   TYPE /SKN/S_TABLE_JOIN,
        LS_SEL_FIELDS        TYPE /SKN/S_SEL_FIELDS,
        LS_BUDAT             TYPE RANGE_S_DATS,
        LS_DATA              TYPE /SKN/S_SW_10_07_FI_DOC_POST_S4,
        LS_X030L             TYPE	X030L,
        LWA_ALL_ENTRIES_TAB  TYPE /SKN/S_SW_TAB6000,
        LWA_ALL_ENTRIES_COND TYPE /SKN/S_TABLE_JOIN.
  DATA: LT_OPTIONS      TYPE TABLE OF RFC_DB_OPT,
        LT_OPTIONS_MAIN TYPE TABLE OF RFC_DB_OPT,
        LT_DFIES_FLD    TYPE TABLE OF DFIES.
  DATA: LT_BUDAT TYPE TABLE OF RANGE_S_DATS.
  DATA: LT_TABLES_LIST    TYPE /SKN/TT_TABLES,
        LT_OUT_WHERE_COND TYPE TABLE OF /SKN/S_SW_WHERE_TAB,
        LT_IN_RANGE       TYPE TABLE OF /SKN/S_SW_RANGE_TAB,
        LT_DATA_RFC       TYPE TABLE OF /SKN/S_SW_TAB2000,
        LT_SEL_FIELDS     TYPE /SKN/TT_SEL_FIELDS,
        LT_SEL_FIELDS2    TYPE /SKN/TT_SEL_FIELDS,
        LT_BSEG           TYPE TABLE OF /SKN/S_SW_10_07_FI_DOC_POSTED.
  DATA LT_JOIN_CONDITION TYPE /SKN/TT_TABLE_JOIN.
  DATA LT_SORT_OPTIONS TYPE TABLE OF /SKN/S_SW_RFC_JOIN_DB_SORT.
  DATA LT_GROUP_BY_OPTIONS TYPE TABLE OF /SKN/S_SW_RFC_JOIN_DB_SORT.
  DATA LT_HAVING_OPTIONS TYPE TABLE OF RFC_DB_OPT.
  DATA LT_OUTPUT_FIELDS TYPE /SKN/TT_RFC_DB_FLD_EXTEND.
  DATA LT_DFIES TYPE TABLE OF DFIES.
  DATA LT_RETURN TYPE BAPIRET2_T.
  DATA LT_ALL_ENTRIES_TAB TYPE TABLE OF /SKN/S_SW_TAB6000.
  DATA LT_ALL_ENTRIES_COND TYPE TABLE OF /SKN/S_TABLE_JOIN.
  DATA LT_ALL_ENTRIES_DFIES TYPE TABLE OF DFIES.
  DATA LV_NAME_FIRST TYPE AD_NAMEFIR.
  DATA LV_NAME_LAST TYPE AD_NAMELAS.
  DATA LV_NAME_TEXT TYPE AD_NAMTEXT.
  DATA LS_WA_ADRP TYPE ADRP.
  FIELD-SYMBOLS: <FS_DATA> TYPE /SKN/S_SW_10_07_FI_DOC_POST_S4,
                 <FS_VAL>  TYPE ANY.
  CLEAR IS_ALERT.
  REFRESH T_DATA.
  REFRESH LT_OPTIONS.
  REFRESH LT_OUT_WHERE_COND.
  REFRESH LT_TABLES_LIST.
  CLEAR: LS_OPTION.
  SELECT_SINGLE: SW_DEST.
  _SET_SYS_DATE_TIME LV_SW_DEST SY_DATLO SY_TIMLO.
  IF R_DATUM[] IS INITIAL.
    RS_DATUM-SIGN   = 'I'.
    IF LV_FORWDAYS IS INITIAL.
      DATE_FROM = SY_DATLO - LV_BACKDAYS.
      DATE_TO   = SY_DATLO.
      RS_DATUM-OPTION = 'BT'.
    ELSE.
      IF LV_BACKDAYS IS NOT INITIAL.
        DATE_FROM = SY_DATLO - LV_BACKDAYS.
        DATE_TO   = SY_DATLO + LV_FORWDAYS.
        RS_DATUM-OPTION = 'BT'.
      ELSE.
        DATE_FROM = SY_DATLO + LV_FORWDAYS.
        RS_DATUM-OPTION = 'GE'.
      ENDIF.
    ENDIF.
  ENDIF.
***************** Get Table Category **********************
  LV_TAB = 'ACDOCA'.
* Check table exist on the client's system
  CALL FUNCTION 'DDIF_FIELDINFO_GET'
    DESTINATION LV_SW_DEST
    EXPORTING
      TABNAME        = LV_TAB
    IMPORTING
      X030L_WA       = LS_X030L
    TABLES
      DFIES_TAB      = LT_DFIES_FLD
    EXCEPTIONS
      NOT_FOUND      = 1
      INTERNAL_ERROR = 2
      OTHERS         = 3.
  CHECK SY-SUBRC IS INITIAL.
  CHECK LT_DFIES_FLD IS NOT INITIAL.
***************** Get Table Category *********************
* Calculate document periods by closing day
  CALL FUNCTION '/SKN/F_SW_GET_DOC_POST_PERIOD'
    EXPORTING
      IV_DATE_FROM         = DATE_FROM
      IV_DATE_TO           = DATE_TO
      IV_CLOSED_PERIOD_DAY = LV_PERIOD_CLOSING_DAY
    TABLES
      ET_DATUM             = R_DATUM[]       " Accounting Entry Date
      ET_BUDAT             = LT_BUDAT[].     " Posting Date
  CLEAR: LT_DATA_RFC[], LT_OUTPUT_FIELDS[], LT_OPTIONS,
         LT_DFIES[], LT_RETURN[], LT_OUT_WHERE_COND[],
         LT_GROUP_BY_OPTIONS, LT_SORT_OPTIONS.
  CLEAR IS_ALERT.
  REFRESH T_DATA.
  _APPEND_TABLES_LIST 'BKPF'   '' 'A'.
  _APPEND_TABLES_LIST 'ACDOCA' '' 'B'.
  _APPEND_TABLES_LIST 'T001' 'X' 'T'.
  REFRESH LT_SEL_FIELDS[].
  _ADAPT_SEL_FIELDS 'BKPF'   '/SKN/S_SW_10_07_FI_DOC_POST_S4'  LT_SEL_FIELDS LV_SW_DEST.
  _ADAPT_SEL_FIELDS 'ACDOCA' '/SKN/S_SW_10_07_FI_DOC_POST_S4'  LT_SEL_FIELDS LV_SW_DEST.
  CLEAR LS_SEL_FIELDS.
  LS_SEL_FIELDS-TABLE = 'ACDOCA'.
  LS_SEL_FIELDS-FIELD = 'BUDAT'.
  LS_SEL_FIELDS-ALIAS = 'BUDAT_ACDOCA'.
  APPEND LS_SEL_FIELDS TO LT_SEL_FIELDS.
  CLEAR LS_SEL_FIELDS.
  LS_SEL_FIELDS-TABLE = 'T001'.
  LS_SEL_FIELDS-FIELD = 'KTOPL'.
  APPEND LS_SEL_FIELDS TO LT_SEL_FIELDS.
* BKPF
  _RANGE_TO_SEL_TABLE 'A~BUKRS'     BUKRS.
  _RANGE_TO_SEL_TABLE 'A~BELNR'     BELNR.
  _RANGE_TO_SEL_TABLE 'A~GJAHR'     GJAHR.
  _RANGE_TO_SEL_TABLE 'A~MONAT'     MONAT.
  _RANGE_TO_SEL_TABLE 'A~TCODE'     TCODE.
  _RANGE_TO_SEL_TABLE 'A~USNAM'     USNAM.
  _RANGE_TO_SEL_TABLE 'A~TCODE'     TCODE.
  _RANGE_TO_SEL_TABLE 'A~XBLNR'     XBLNR.
  _RANGE_TO_SEL_TABLE 'A~XREVERSAL' XREVERSAL.
  _RANGE_TO_SEL_TABLE 'A~BSTAT'     BSTAT.
  _RANGE_TO_SEL_TABLE 'A~GRPID'     GRPID.
  _RANGE_TO_SEL_TABLE 'A~STBLG'     STBLG.
  _RANGE_TO_SEL_TABLE 'A~BKTXT'     BKTXT.
* ACDOCA
  _RANGE_TO_SEL_TABLE 'B~RBUKRS'  RBUKRS.
  _RANGE_TO_SEL_TABLE 'B~RLDNR'   RLDNR.
  _RANGE_TO_SEL_TABLE 'B~DOCLN'   DOCLN.
  _RANGE_TO_SEL_TABLE 'B~RCNTR'   RCNTR.
  _RANGE_TO_SEL_TABLE 'B~PRCTR'   PRCTR.
  _RANGE_TO_SEL_TABLE 'B~RACCT'   RACCT.
  _RANGE_TO_SEL_TABLE 'B~RFAREA'  RFAREA.
  _RANGE_TO_SEL_TABLE 'B~RBUSA'   RBUSA.
  _RANGE_TO_SEL_TABLE 'B~KOKRS'   KOKRS.
  _RANGE_TO_SEL_TABLE 'B~SEGMENT' SEGMENT.
  _RANGE_TO_SEL_TABLE 'B~KTOSL'   KTOSL.
  _RANGE_TO_SEL_TABLE 'B~EBELN'   EBELN.
  _RANGE_TO_SEL_TABLE 'B~EBELP'   EBELP.
  _RANGE_TO_SEL_TABLE 'B~MATNR'   MATNR.
  _RANGE_TO_SEL_TABLE 'B~WERKS'   WERKS.
  _RANGE_TO_SEL_TABLE 'B~LIFNR'   LIFNR.
  _RANGE_TO_SEL_TABLE 'B~KUNNR'   KUNNR.
  _RANGE_TO_SEL_TABLE 'B~FKART'   FKART.
  _RANGE_TO_SEL_TABLE 'B~VKORG'   VKORG.
  _RANGE_TO_SEL_TABLE 'B~VTWEG'   VTWEG.
  _RANGE_TO_SEL_TABLE 'B~SPART'   SPART.
  _RANGE_TO_SEL_TABLE 'B~MATKL'   MATKL.
  _RANGE_TO_SEL_TABLE 'B~KDGRP'   KDGRP.
  _RANGE_TO_SEL_TABLE 'B~LAND1'   LAND1.
  _RANGE_TO_SEL_TABLE 'B~BLART'   BLART.
  _RANGE_TO_SEL_TABLE 'B~HSL'     HSL.
  _RANGE_TO_SEL_TABLE 'B~HVKWRT'  HVKWRT.
  _RANGE_TO_SEL_TABLE 'B~KSL'     KSL.
  _RANGE_TO_SEL_TABLE 'B~OSL'     OSL.
  _RANGE_TO_SEL_TABLE 'B~PSL'     PSL.
  _RANGE_TO_SEL_TABLE 'B~TSL'     TSL.
  _RANGE_TO_SEL_TABLE 'B~VSL'     VSL.
  _RANGE_TO_SEL_TABLE 'B~WSL'     WSL.
  _RANGE_TO_SEL_TABLE 'B~WSL2'    WSL2.
  _RANGE_TO_SEL_TABLE 'B~WSL3'    WSL3.
  _RANGE_TO_SEL_TABLE 'B~RTCUR'  RTCUR.
  _RANGE_TO_SEL_TABLE 'B~RWCUR'  RWCUR.
  _RANGE_TO_SEL_TABLE 'B~RHCUR'  RHCUR.
  _RANGE_TO_SEL_TABLE 'B~RKCUR'  RKCUR.
  _RANGE_TO_SEL_TABLE 'B~ROCUR'  ROCUR.
  _RANGE_TO_SEL_TABLE 'B~RVCUR'  RVCUR.
  _RANGE_TO_SEL_TABLE 'B~KOART'  KOART.
* T001
  _RANGE_TO_SEL_TABLE 'T~KTOPL'  KTOPL.
  LT_OPTIONS_MAIN[] = LT_OUT_WHERE_COND[].
  LOOP AT R_DATUM INTO RS_DATUM.
    LV_TABIX = SY-TABIX.
    REFRESH: R_CPUDT, R_AEDAT, R_UPDDT, R_BLDAT, R_BUDAT.
    CLEAR: LT_OPTIONS, LT_OUT_WHERE_COND[].
    CASE LV_DATE_REF_FLD.
      WHEN 'CPUDT'.
        MOVE-CORRESPONDING RS_DATUM TO RS_CPUDT.
        APPEND RS_CPUDT TO R_CPUDT.
      WHEN 'BLDAT'.
        MOVE-CORRESPONDING RS_DATUM TO RS_BLDAT.
        APPEND RS_BLDAT TO R_BLDAT.
      WHEN 'AEDAT'.
        MOVE-CORRESPONDING RS_DATUM TO RS_AEDAT.
        APPEND RS_AEDAT TO R_AEDAT.
      WHEN 'UPDDT'.
        MOVE-CORRESPONDING RS_DATUM TO RS_UPDDT.
        APPEND RS_UPDDT TO R_UPDDT.
    ENDCASE.
    _RANGE_TO_SEL_TABLE 'A~AEDAT' AEDAT.
    _RANGE_TO_SEL_TABLE 'A~CPUDT' CPUDT.
    _RANGE_TO_SEL_TABLE 'A~UPDDT' UPDDT.
    _RANGE_TO_SEL_TABLE 'A~BLDAT' BLDAT.
* Set BUDAT condition date
    READ TABLE LT_BUDAT INTO LS_BUDAT INDEX LV_TABIX.
    IF SY-SUBRC IS INITIAL.
      MOVE-CORRESPONDING LS_BUDAT TO RS_BUDAT.
      APPEND RS_BUDAT TO R_BUDAT.
      CLEAR: LS_BUDAT.
    ENDIF.
    _RANGE_TO_SEL_TABLE 'B~BUDAT' BUDAT.
    LT_OPTIONS[] = LT_OUT_WHERE_COND[].
    IF LT_OPTIONS[]      IS NOT INITIAL AND
       LT_OPTIONS_MAIN[] IS NOT INITIAL.
      LS_OPTION-TEXT = 'AND'.
      APPEND LS_OPTION TO LT_OPTIONS.
    ENDIF.
    APPEND LINES OF LT_OPTIONS_MAIN TO LT_OPTIONS.
* Join condition
    REFRESH LT_JOIN_CONDITION[].
    _JOIN_CONDITION 'A' 'BUKRS' 'B' 'RBUKRS'.
    _JOIN_CONDITION 'A' 'GJAHR' 'B' 'GJAHR'.
    _JOIN_CONDITION 'A' 'BELNR' 'B' 'BELNR'.
    _JOIN_CONDITION 'A' 'BUKRS' 'T' 'BUKRS'.
******************************* Get data  *************************
    CALL FUNCTION '/SKN/RFC_JOIN_TABLES'
      DESTINATION LV_SW_DEST
      IMPORTING
        ROWCOUNT             = LV_ROWCOUNT
      TABLES
        OPTIONS              = LT_OPTIONS
        DATA                 = LT_DATA_RFC
        TABLES_LIST          = LT_TABLES_LIST
        JOIN_CONDITION       = LT_JOIN_CONDITION
        SEL_FIELDS           = LT_SEL_FIELDS
        SORT_OPTIONS         = LT_SORT_OPTIONS
        GROUP_BY_OPTIONS     = LT_GROUP_BY_OPTIONS
        HAVING_OPTIONS       = LT_HAVING_OPTIONS
        OUTPUT_FIELDS        = LT_OUTPUT_FIELDS
        DFIES                = LT_DFIES
        RETURN               = LT_RETURN
      EXCEPTIONS
        TABLE_NOT_AVAILABLE  = 1
        TABLE_WITHOUT_DATA   = 2
        OPTION_NOT_VALID     = 3
        FIELD_NOT_VALID      = 4
        NOT_AUTHORIZED       = 5
        DATA_BUFFER_EXCEEDED = 6
        OTHERS               = 7.
    IF SY-SUBRC IS NOT INITIAL OR LT_RETURN IS NOT INITIAL.
      CLEAR LT_DATA_RFC.
    ELSE.
      _RFC_TO_T_DATA_INDEX LT_DATA_RFC LT_DATA_TMP LT_OUTPUT_FIELDS 1.
    ENDIF.
    APPEND LINES OF LT_DATA_TMP TO LT_DATA.
    CLEAR: LT_DATA_TMP.
  ENDLOOP.
  IF LT_DATA IS NOT INITIAL.
    SORT LT_DATA BY RBUKRS GJAHR BELNR DOCLN.
    DELETE ADJACENT DUPLICATES FROM LT_DATA COMPARING RBUKRS GJAHR BELNR DOCLN.
  ENDIF.
*-- Calculate Status Duration (associating to Reference Field (DATE_REF_FLD)
  LOOP AT LT_DATA ASSIGNING <FS_DATA>.
    FLD = LV_DATE_REF_FLD.
    ASSIGN COMPONENT FLD OF STRUCTURE <FS_DATA> TO <FS_VAL>.
    CHECK <FS_VAL> IS ASSIGNED.
    REF_DATE = <FS_VAL> .
    IF NOT REF_DATE IS INITIAL.
      <FS_DATA>-DURATION_UNIT = LV_DURATION_UNIT.
      CALL FUNCTION '/SKN/F_SW_GET_TIME_DIFF'
        EXPORTING
          D_FROM      = REF_DATE
          T_FROM      = SY-UZEIT
          D_TO        = SY-DATUM
          T_TO        = SY-UZEIT
          TIME_UNIT   = LV_DURATION_UNIT   "'D'
        IMPORTING
          TIME_DIFF   = TIME_DIFF
        EXCEPTIONS
          WRONG_VALUE = 1
          OTHERS      = 2.
      IF SY-SUBRC = 0.
        IF TIME_DIFF < '999999'.
          <FS_DATA>-DURATION  = TIME_DIFF .
        ELSE.
          <FS_DATA>-DURATION  = '999999'.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDLOOP.
  DELETE LT_DATA WHERE DURATION NOT IN R_DURATION .
  LOOP AT LT_DATA INTO LS_DATA.
************************************************ Semantics **************************************************
    IF LS_DATA-BLART IS NOT INITIAL.
* Get Document Type desc.
      CALL FUNCTION '/SKN/F_SW_10_BLART_DESC'
        EXPORTING
          BLART      = LS_DATA-BLART
          LANGU      = LV_LANGU
          SW_DEST    = LV_SW_DEST
        IMPORTING
          TYPE_DESC  = LS_DATA-BLART_DESC
        EXCEPTIONS
          WRONG_CODE = 1
          OTHERS     = 2.
    ENDIF.
    IF LS_DATA-RBUKRS IS NOT INITIAL.
* Get Company code desc.
      CALL FUNCTION '/SKN/F_SW_10_COMP_CODE_DESC'
        EXPORTING
          BUKRS          = LS_DATA-RBUKRS
          SW_DEST        = LV_SW_DEST
        IMPORTING
          COMP_CODE_DESC = LS_DATA-RBUKRS_DESC
        EXCEPTIONS
          WRONG_CODE     = 1
          OTHERS         = 2.
    ENDIF.
    IF LS_DATA-SPART IS NOT INITIAL.
      CALL FUNCTION '/SKN/F_SW_10_DIVISION_DESC'
        EXPORTING
          SPART      = LS_DATA-SPART
          LANGU      = LV_LANGU
          SW_DEST    = LV_SW_DEST
        IMPORTING
          DIV_DESC   = LS_DATA-SPART_DESC
        EXCEPTIONS
          WRONG_CODE = 1
          OTHERS     = 2.
    ENDIF.
    IF LS_DATA-USNAM IS NOT INITIAL.
* user name & surname
      CALL FUNCTION '/SKN/FC_SW_01_GET_DETAILES_BUF'
        EXPORTING
          BNAME      = LS_DATA-USNAM   " User Name in User Master Record
          SW_DEST    = LV_SW_DEST      " Logical Destination (Specified in Function Call)
        IMPORTING
          NAME_FIRST = LV_NAME_FIRST
          NAME_LAST  = LV_NAME_LAST
          NAME_TEXT  = LV_NAME_TEXT
        EXCEPTIONS
          NO_DATA    = 1
          OTHERS     = 2.
      IF SY-SUBRC IS INITIAL.
        LS_DATA-USNAM_DESC = LV_NAME_TEXT.
      ENDIF.
      CLEAR: LV_NAME_TEXT.
    ENDIF.
    IF LS_DATA-RACCT IS NOT INITIAL AND
       LS_DATA-KTOPL IS NOT INITIAL.
* Get GL Account Desc.
      CALL FUNCTION '/SKN/FC_SW_10_GL_DESC'
        EXPORTING
          KTOPL      = LS_DATA-KTOPL      " Chart of Accounts
          SAKNR      = LS_DATA-RACCT      " G/L Account Number
          LANGU      = LV_LANGU           " Language Key
          SW_DEST    = LV_SW_DEST         " Logical Destination (Specified in Function Call)
        IMPORTING
*         TXT20      =                    " G/L account short text
          TXT50      = LS_DATA-RACCT_DESC " G/L Account Long Text
        EXCEPTIONS
          WRONG_CODE = 1
          OTHERS     = 2.
      IF SY-SUBRC EQ 0.
      ENDIF.
    ENDIF.
    IF LS_DATA-VKORG IS NOT INITIAL.
* Get Sales Org. description
      CALL FUNCTION '/SKN/F_SW_10_SALES_ORG_DESC'
        EXPORTING
          VKORG          = LS_DATA-VKORG
          LANGU          = LV_LANGU
          SW_DEST        = LV_SW_DEST
        IMPORTING
          SALES_ORG_DESC = LS_DATA-VKORG_DESC
        EXCEPTIONS
          WRONG_CODE     = 1
          OTHERS         = 2.
    ENDIF.
    IF LS_DATA-VTWEG_DESC IS NOT INITIAL.
* Get Distr.Channel description
      CALL FUNCTION '/SKN/F_SW_10_DISTR_CHAN_DESC'
        EXPORTING
          VTWEG           = LS_DATA-VTWEG
          LANGU           = LV_LANGU
          SW_DEST         = LV_SW_DEST
        IMPORTING
          DISTR_CHAN_DESC = LS_DATA-VTWEG_DESC
        EXCEPTIONS
          WRONG_CODE      = 1
          OTHERS          = 2.
    ENDIF.
    IF LS_DATA-MATKL IS NOT INITIAL.
      CALL FUNCTION '/SKN/F_SW_10_MAT_GRP_DESC'
        EXPORTING
          MATKL      = LS_DATA-MATKL
          LANGU      = LV_LANGU
          SW_DEST    = LV_SW_DEST
        IMPORTING
          MATKL_DESC = LS_DATA-MATKL_DESC
        EXCEPTIONS
          WRONG_CODE = 1
          OTHERS     = 2.
    ENDIF.
    IF LS_DATA-WERKS IS NOT INITIAL.
* Get Plant description
      CALL FUNCTION '/SKN/F_SW_10_PLANT_DESC'
        EXPORTING
          WERKS      = LS_DATA-WERKS
          LANGU      = LV_LANGU
          SW_DEST    = LV_SW_DEST
        IMPORTING
          PLANT_DESC = LS_DATA-WERKS_DESC
        EXCEPTIONS
          WRONG_CODE = 1
          OTHERS     = 2.
    ENDIF.
    IF LS_DATA-MATNR IS NOT INITIAL.
    ENDIF.
    IF LS_DATA-PRCTR IS NOT INITIAL AND
       LS_DATA-KOKRS IS NOT INITIAL.
* Get Profit Center description
      CALL FUNCTION '/SKN/F_SW_10_PRCTR_DESC'
        EXPORTING
          SPRAS      = LV_LANGU
          PRCTR      = LS_DATA-PRCTR
          KOKRS      = LS_DATA-KOKRS
          SW_DEST    = LV_SW_DEST
        IMPORTING
          KTEXT      = LS_DATA-PRCTR_DESC
        EXCEPTIONS
          WRONG_CODE = 1
          OTHERS     = 2.
    ENDIF.
    IF LS_DATA-LIFNR IS NOT INITIAL.
* Get Vendor description
      CALL FUNCTION '/SKN/F_SW_10_VENDOR_DESC'
        EXPORTING
          LIFNR        = LS_DATA-LIFNR
          SW_DEST      = LV_SW_DEST
        IMPORTING
          VENDOR_DESC  = LS_DATA-LIFNR_DESC
        EXCEPTIONS
          WRONG_VENDOR = 1
          OTHERS       = 2.
    ENDIF.
    IF LS_DATA-LAND1 IS NOT INITIAL.
      CALL FUNCTION '/SKN/F_SW_10_COUNTRY_DESC'
        EXPORTING
          LAND1      = LS_DATA-LAND1
          LANGU      = LV_LANGU
          SW_DEST    = LV_SW_DEST
        IMPORTING
          LANDX      = LS_DATA-LAND1_DESC
        EXCEPTIONS
          WRONG_CODE = 1
          OTHERS     = 2.
    ENDIF.
    IF LS_DATA-KUNNR IS NOT INITIAL.
      CALL FUNCTION '/SKN/F_SW_10_CUST_DESC'
        EXPORTING
          KUNNR          = LS_DATA-KUNNR
          SW_DEST        = LV_SW_DEST
        IMPORTING
          CUST_DESC      = LS_DATA-KUNNR_DESC
*         LAND1          =
        EXCEPTIONS
          WRONG_CUSTOMER = 1
          OTHERS         = 2.
    ENDIF.
************************************************* Semantics **************************************************
    APPEND LS_DATA TO T_DATA.
  ENDLOOP.
  CHECK T_DATA[] IS NOT INITIAL.
*--- Check Alert Information
  READ TABLE T_DATA INDEX 1.
  CHECK NOT SY-TFILL IS INITIAL .
  IS_ALERT = 'X' .
ENDFUNCTION.